<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src='lib/quintus.js'></script>
        <script src='lib/quintus_sprites.js'></script>
        <script src='lib/quintus_scenes.js'></script>
        <script src='lib/quintus_input.js'></script>
        <script src='lib/quintus_anim.js'></script>
        <script src='lib/quintus_2d.js'></script>
        <script src='lib/quintus_touch.js'></script>
        <script src='lib/quintus_ui.js'></script>
        <script src='lib/quintus_ui.js'></script>
        <script src='lib/quintus_audio.js'></script>
    </head>
    <body style="background-color: black;">
        <script>
            var Game_over = "sem erro";
            var contadorFase = "fase1";
            var diferent = true;
            var MusicaTocando = true;
            var MusicStatus = "MÃºsica: ON";
            var opcoes = ['letraA', /*'letraB',*/ /*'letraC',*/ /*'letraD',*/ 'letraE', 'letraF', /*'letraG',*/ 'letraH', /*'letraI',*/ /*'letraJ',*/ 'letraK', /*(NR)'letraL', (NR)'letraM', (NR)'letraN', (NR)'letraO', (NR)'letraP', (NR)'letraQ', (NR)'letraS', (NR)'letraT', (NR)'letraU', (NR)'letraV', (NR)'letraX', (NR)'letraW', (NR)'letraZ'*/];
            var opcoesL = ['A', /*'B',*/ /*'C',*/ /*'D',*/ 'E', 'F', /*'G',*/ 'H', /*'I',*/ /*'J',*/ 'K', /*(NR)'L', (NR)'M', (NR)'N', (NR)'O', (NR)'P', (NR)'Q', (NR)'S', (NR)'T', (NR)'U', (NR)'V', (NR)'X', (NR)'W', (NR)'Z'*/];
            var opc1 =[Math.floor(Math.random()* (/*23*/4 - 0) + 1), Math.floor(Math.random()* (/*23*/4 - 0) + 1), Math.floor(Math.random()* (/*23*/4 - 0) + 1)];
            if(opc1[0] == opc1[1] || opc1[0] == opc1[2] || opc1[1] == opc1[2]){
                while(diferent){
                    if(opc1[0] == opc1[1]){
                        opc1[1] = Math.floor(Math.random()* (/*23*/4 - 0) + 1);
                    }
                    if(opc1[0] == opc1[2]){
                        opc1[2] = Math.floor(Math.random()* (/*23*/4 - 0) + 1);
                    }
                    if(opc1[1] == opc1[2]){
                        opc1[2] = Math.floor(Math.random()* (/*23*/4 - 0) + 1);
                    }
                    if(opc1[0] != opc1[1] && opc1[0] != opc1[2] && opc1[1] && opc1[2]){
                        diferent = false;
                    }
                }
            }
            var Q = Quintus({ audioSupported: [ 'mp3' ] })
                    .include("Sprites, Scenes, Input, 2D, Touch, UI, Audio")
                    .enableSound()
                    .setup({
                        width: 960,
                        height: 640
                    }).controls().touch();
            //Jogador Investigador
            Q.Sprite.extend("Player", {
                init: function (p) {
                    this._super(p, {asset: "player.png", x: 110, y: 50, jumpSpeed: -380});
                    this.add('2d, platformerControls');
                },
                step: function (dt) {
                    if (Q.inputs['left'] && this.p.direction == 'right') {
                        this.p.flip = 'x';
                    }
                    if (Q.inputs['right'] && this.p.direction == 'left') {
                        this.p.flip = false;
                    }
                    if ((contadorFase == "fase1") && (Q.inputs[opcoes[opc1[0]]]))
                    {
                        contadorFase = "Fase2";
                        Q.stageScene("level"+ contadorFase.charAt(4) +"");
                        Q.stageScene("dialogo", 1);
                        Q.stageScene("menu", 2);
                    }
                    //////////////////////------------------------------------/////////////////////////////--------------///////////////////////----------------
                    if (contadorFase == "Fase2")
                    {
                        if(Game_over =="sem erro")
                        {
                            if (Q.inputs['letraG'])
                            {
                                Game_over="erro1";
                                contadorFase = "ErroMuseu";
                                Q.stageScene("level6");
                                Q.stageScene("dialogo", 1);
                                Q.stageScene("menu", 2);
                            }
                        }
                        else if(Game_over =="erro1")
                        {
                            if (Q.inputs['letraG'])
                            {
                                Q.stageScene("GO");
                                Q.stageScene("dialogo2", 1);
                                Q.stageScene("menu2", 2);
                            }
                        }
                    }
                    ///////////////////////////------------------------------///////////////////////////////////////////////////////////////---------------------
                    //outros ifs
                    if (contadorFase == "fase1")
                    {
                        if(Game_over == "sem erro")
                        {
                            if (Q.inputs['letraC'])
                            {
                                Game_over = "erro1";
                                contadorFase = "ErroIgre";
                                Q.stageScene("levelErroIgre");
                                Q.stageScene("dialogo", 1);
                                Q.stageScene("menu", 2);
                            }
                        }
                        else if(Game_over == "erro1")
                        {
                            if (Q.inputs['letraC'])
                            {
                                Q.stageScene("GO");
                                Q.stageScene("dialogo2", 1);
                                Q.stageScene("menu2", 2);
                            }
                        }
                    }
                    ///////////////////////////////////////----------------Fase 2 ---------------------------/////////////////////////////////////----------------////////////////////////////////////
                    if (contadorFase == "Fase2")
                    {
                        if(Game_over == "sem erro")
                        {
                            if (Q.inputs['letraC'])
                            {
                                Game_over = "erro1";
                                contadorFase = "ErroIgre";
                                Q.stageScene("levelErroIgre");
                                Q.stageScene("dialogo", 1);
                                Q.stageScene("menu", 2);
                            }
                        }
                        else if(Game_over == "erro1")
                        {
                            if (Q.inputs['letraC'])
                            {
                                Q.stageScene("GO");
                                Q.stageScene("dialogo2", 1);
                                Q.stageScene("menu2", 2);
                            }
                        }
                    }
                    ////////////////////////////////////-----------------------------------fase 1 --------------------/////////////////////////////////////////////
                    if (contadorFase == "fase1")
                    {
                        if(Game_over == "sem erro")
                        {
                            if (Q.inputs['letraB'])
                            {
                                Game_over = "erro1";
                                contadorFase = "ErroJuru";
                                Q.stageScene("levelErroJuru");
                                Q.stageScene("dialogo", 1);
                                Q.stageScene("menu", 2);
                            }   
                        }
                        else if(Game_over == "erro1")
                        {   
                            if(Q.inputs['letraB'])
                            {
                                Q.stageScene("GO"); 
                                Q.stageScene("dialogo2", 1);
                                Q.stageScene("menu2", 2);
                            }
                        }
                    }
                    ///////////////////////////////////////////----------------------------fase 2--------------------------------------/////////////////////////////////    
                    if (contadorFase == "Fase2")
                    {
                        if (Q.inputs[opcoes[opc1[1]]])
                        {
                            contadorFase = "Fase3";
                            Q.stageScene("level5");
                            Q.stageScene("dialogo", 1);
                            Q.stageScene("menu", 2);
                        }
                    }
                    //////////////////////////////////////-----------------------------fase 3------------------------------------/////////////////////////////////////////
                    if (contadorFase == "Fase3")
                    {
                        if (Q.inputs[opcoes[opc1[2]]])
                        {
                            contadorFase = "Fase4";
                            Q.stageScene("level4");
                            Q.stageScene("dialogo", 1);
                            Q.stageScene("menu", 2);
                        }
                    }
                    ///////////////////////-------fase 3 ------------------------------------/////////////////////////////////////////
                    
                    if (contadorFase == "Fase3")
                    {
                        if(Game_over == "sem erro")
                        {
                            if (Q.inputs['letraI'])
                            {
                                Game_over = "erro1";
                                contadorFase = "ErroSobrad";
                                Q.stageScene("levelErroSob");
                                Q.stageScene("dialogo", 1);
                                Q.stageScene("menu", 2);
                            }   
                        }
                        else if(Game_over == "erro1")
                        {   
                            if(Q.inputs['letraI'])
                            {
                                Q.stageScene("GO"); 
                                Q.stageScene("dialogo2", 1);
                                Q.stageScene("menu2", 2);
                            }
                        }
                    }
                 //----fase 3 ------------------------------------/////////////////////////////////////////
                   if (contadorFase == "Fase3")
                    {
                    if(Game_over == "sem erro")
                        {
                            if (Q.inputs['letraJ'])
                            {
                                Game_over="erro1";
                                contadorFase = "ErroMP";
                                Q.stageScene("levelErroMP");
                                Q.stageScene("dialogo", 1);
                                Q.stageScene("menu", 2);
                            }
                        }
                       else if(Game_over == "erro1")
                        {
                            if (Q.inputs['letraJ'])
                            {
                                Q.stageScene("GO");
                                Q.stageScene("dialogo2", 1);
                                Q.stageScene("menu2", 2);
                            }
                        }
                    }
                    
                    //////////////////-------////////////////////////////////////-----------------------------------------------------------////////////////////////////////
                    if(contadorFase.charAt(0) == "E" || contadorFase == "Fase4")
                    {

                        if (Q.inputs['letraD'] && contadorFase == "Fase4")
                        {
                        	Game_over = "sem erro"
                            contadorFase = "fase1";
                            Q.stageScene("level1");
                            Q.stageScene("dialogo", 1);
                            Q.stageScene("menu", 2);
                        }
                        else if (Q.inputs['letraD'])
                        {
                            contadorFase = "fase1";
                            Q.stageScene("level1");
                            Q.stageScene("dialogo", 1);
                            Q.stageScene("menu", 2);
                        }
                    }
                    ///////////////////////----------------------------fase 1 -------------------------////////////////////////////////////////////////

                }
            });
            
            Q.load([ "laconicgranny.mp3" ], function() {
                Q.audio.play('laconicgranny.mp3',{ loop: true });
            });
            
            //Menu dialogo com as testemunhas
            Q.scene("dialogo", function (stage) {
                var dialogo = stage.insert(new Q.UI.Container({
                    fill: "gray",
                    x: 960 / 2 - 150,
                    y: 620,
                    border: 1,
                    shadow: 3,
                    shadowColor: "rgba(0,0,0,0.5)",
                    w: 600,
                    h: 230
                })
                        );
                var testemunha = stage.insert(new Q.UI.Text({
                    label: "",
                    color: "black",
                    x: 0,
                    y: -60
                }), dialogo);
                //BotÃ£o Musica
                var Music = stage.insert(new Q.UI.Button({
                    fill: "gray",
                    label: MusicStatus,
                    x: 2050 / 2 - 150,
                    y: 30,
                    border: 1,
                    shadow: 3,
                    shadowColor: "rgba(0,0,0,0.5)",
                    w: 150,
                    h: 40
                    }, function(){
                        if (MusicaTocando == true){
                            Q.audio.stop("laconicgranny.mp3");
                            MusicaTocando = false;
                            this.p.label = "MÃºsica: OFF";
                            MusicStatus = "MÃºsica: OFF";
                        }else if (MusicaTocando == false){
                            Q.audio.play('laconicgranny.mp3',{ loop: true });
                            MusicaTocando = true;
                            this.p.label = "MÃºsica: ON";
                            MusicStatus = "MÃºsica: ON";
                        }
                    }));
            });

            //Game Over
             Q.scene("GO", function (stage) {
                var menu = stage.insert(new Q.UI.Container({
                    fill: "black",
                    x: 960 / 2 + 300,
                    y: 620,
                    border: 1,
                    shadow: 3,
                    shadowColor: "rgba(0,0,0,0.5)",
                    w: 2000,
                    h: 5000
                })
                        );
                });
            
            //Menu
            Q.scene("menu", function (stage) {
                var menu = stage.insert(new Q.UI.Container({
                    fill: "white",
                    x: 960 / 2 + 300,
                    y: 620,
                    border: 1,
                    shadow: 3,
                    shadowColor: "rgba(0,0,0,0.5)",
                    w: 290,
                    h: 230
                })
                        );
                var opcao = stage.insert(new Q.UI.Text({
                    label: "Caminhos possÃ­veis:",
                    color: "gray",
                    x: 0,
                    y: -100
                }), menu);
                if (contadorFase == "fase1")
                {
                    var destino1 = stage.insert(new Q.UI.Text({
                        label: ""+ opcoesL[opc1[0]] +" - Sobradinho",
                        color: "black",
                        x: 0,
                        y: -65
                    }), menu);
                }
                if (contadorFase == "Fase2")
                {
                    var destino1 = stage.insert(new Q.UI.Text({
                        label: "G - Museu",
                        color: "black",
                        x: 0,
                        y: -65
                    }), menu);
                }
                if (contadorFase == "Fase3")
                {
                    var destino1 = stage.insert(new Q.UI.Text({
                        label: "I - Sobradinho",
                        color: "black",
                        x: 0,
                        y: -65
                    }), menu);
                }
                /////////////////////////////////////////////==============OpÃ§Ã£o 2===============//////////////////////////////==================////////

                if (contadorFase == "fase1") {
                    var destino2 = stage.insert(new Q.UI.Text({
                        label: "B - Jurubatiba",
                        color: "black",
                        x: 0,
                        y: -40
                    }), menu);
                }
                if (contadorFase == "Fase2") { //opÃ§Ã£o correta
                    var destino2 = stage.insert(new Q.UI.Text({
                        label: ""+ opcoesL[opc1[1]] +" - Usina",
                        color: "black",
                        x: 0,
                        y: -40
                    }), menu);
                }
                if (contadorFase == "Fase3") {
                    var destino2 = stage.insert(new Q.UI.Text({
                        label: "J - Mato de Pipa",
                        color: "black",
                        x: 0,
                        y: -40
                    }), menu);
                }

                //////////////////////////////=======================OpÃ§Ã£o 3============/////////////////////////////=======================//////////////////==
                if (contadorFase == "fase1") {
                    var destino3 = stage.insert(new Q.UI.Text({
                        label: "C - Igreja do Carmo",
                        color: "black",
                        x: 0,
                        y: -15
                    }), menu);

                }
                if (contadorFase == "Fase2") {
                    var destino3 = stage.insert(new Q.UI.Text({
                        label: "C - Igreja do Carmo",
                        color: "black",
                        x: 0,
                        y: -15
                    }), menu);

                }
                if (contadorFase == "Fase3") {
                    var destino3 = stage.insert(new Q.UI.Text({
                        label: ""+ opcoesL[opc1[2]] +" - Jurubatiba",
                        color: "black",
                        x: 0,
                        y: -15
                    }), menu);

                }

                //////////////////////////////////////=============OpÃ§Ã£o 4=============/////////////////////////////=================////////////////
                if(contadorFase.charAt(0) == "E")
                {
                    var destino4 = stage.insert(new Q.UI.Text({
                        label: "D - Voltar",
                        color: "black",
                        x: 0,
                        y: -50
                    }), menu);
                }
                if(contadorFase == "Fase4"){
                    var destino4 = stage.insert(new Q.UI.Text({
                        label: "D - Reiniciar",
                        color: "black",
                        x: 0,
                        y: -50
                    }), menu);
                }
            });
            //sumir menu
            Q.scene("menu2", function (stage) {
                var menu2 = stage.insert(new Q.UI.Container({
                    fill: "black",
                    x: 960 / 2 + 300,
                    y: 620,
                    border: 0,
                    shadow: 0,
                    shadowColor: "rgba(0,0,0,0.5)",
                    w: 2000,
                    h: 5000
                })
                        );
                var opcao2 = stage.insert(new Q.UI.Text({
                    label: "VocÃª se perdeu e o JoÃ£o GambÃ¡ fugiu novamente",
                    color: "white",
                    x: -295,
                    y: -290
                }), menu2);
                    var Restart = stage.insert(new Q.UI.Button({
                    fill: "gray",
                    label:"Reiniciar",
                    x: 1250 / 2 - 150,
                    y: 400,
                    border: 1,
                    shadow: 3,
                    shadowColor: "rgba(0,0,0,0.5)",
                    w: 150,
                    h: 40
                    }, function(){
                        Q.clearStages();
                        Q.stageScene("level1");
                        Q.stageScene("dialogo", 1);
                        Q.stageScene("menu", 2);
                        Game_over = "sem erro";
                        if (MusicaTocando == false){
                            Q.audio.play("laconicgranny.mp3");
                            MusicaTocando = true;
                            MusicStatus = "MÃºsica: ON";
                        }
                    }));
                     //BotÃ£o Musica
                var MusicGO = stage.insert(new Q.UI.Button({
                    fill: "gray",
                    label:"MÃºsica: ON",
                    x: 2050 / 2 - 150,
                    y: 30,
                    border: 1,
                    shadow: 3,
                    shadowColor: "rgba(0,0,0,0.5)",
                    w: 150,
                    h: 40
                    }, function(){
                        if (MusicaTocando == true){
                            Q.audio.stop("laconicgranny.mp3");
                            MusicaTocando = false;
                            this.p.label = "MÃºsica: OFF";
                        }else if (MusicaTocando == false){
                            Q.audio.play('laconicgranny.mp3',{ loop: true });
                            MusicaTocando = true;
                            this.p.label = "MÃºsica: ON";
                        }
                    }));
            });
            //posicionamento das imagens dos level's
            Q.Sprite.extend("casa", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("sobradinho", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("IgrejaCarmo", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("juruba", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("varUsina", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("museuQS", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("juruErro", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("igreErro", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("MPErro", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("SobErro", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            Q.Sprite.extend("bandido", {
                init: function (p) {
                    this._super(p, {vy: -100, rangeY: 200, });
                }
            });
            //Componente geral de testemunhas (inimigos, do tutorial)
            Q.component("commonEnemy1", {
                added: function () {
                    var entity = this.entity;
                    entity.on("bump.left,bump.right,bump.bottom", function (collision) {
                        if (collision.obj.isA("Player")) {
                            var testemunho = Q("UI.Text", 1).items[0];
                            if (contadorFase == "fase1")
                            {
                                testemunho.p.label = "Pediu informaÃ§Ã£o sobre aulas de violÃ£o";
                            }
                            if (contadorFase == "Fase2")
                            {
                                testemunho.p.label = "Ele conheceu uma Maria FumaÃ§a";
                            }
                            if (contadorFase == "Fase3")
                            {
                                testemunho.p.label = "Ele queria se sintonizar com a natureza";
                            }
                            if (contadorFase == "Fase4")
                            {
                                testemunho.p.label = "ParabÃ©ns!!!";
                            }
                            if(contadorFase.charAt(0) == "E")
                            {
                            	testemunho.p.label = "NÃ£o ouvi nada sobre isso";
                            }
                        }
                    });
                },
            });

            Q.component("commonEnemy2", {
                added: function () {
                    var entity = this.entity;
                    entity.on("bump.left,bump.right,bump.bottom", function (collision) {
                        if (collision.obj.isA("Player")) {
                            var testemunho = Q("UI.Text", 1).items[0];
                            if (contadorFase == "fase1") {
                                testemunho.p.label = 'Ele queria assistir filmes';
                            }
                            if (contadorFase == "Fase2") {
                                testemunho.p.label = "Ele falou do ponto mais alto de QuissamÃ£";
                            }
                            if (contadorFase == "Fase3")
                            {
                                testemunho.p.label = "O suspeito queria tomar suco de cajÃº";
                            }
                            if (contadorFase == "Fase4")
                            {
                                testemunho.p.label = "VocÃª prendeu o suspeito!";
                            }
                            if(contadorFase.charAt(0) == "E")
                            {
                            	testemunho.p.label = "NÃ£o sei de nada nÃ£o.";
                            }
                        }
                    });
                },
            });

            Q.component("commonEnemy3", {
                added: function () {
                    var entity = this.entity;
                    entity.on("bump.left,bump.right,bump.bottom", function (collision) {
                        if (collision.obj.isA("Player")) {
                            var testemunho = Q("UI.Text", 1).items[0];
                            if (contadorFase == "fase1") {
                                testemunho.p.label = 'Ele comentava sobre uma estaÃ§Ã£o de trem';
                            }
                            if (contadorFase == "Fase2") {
                                testemunho.p.label = "O suspeito tinha uma cÃ³pia de O Gancho";
                            }
                            if (contadorFase == "Fase3")
                            {
                                testemunho.p.label = "Ele estava falando de um crime na Estivinha";
                            }
                            if (contadorFase == "Fase4")
                            {
                                testemunho.p.label = "VocÃª venceu!!!";
                            }
                            if(contadorFase.charAt(0) == "E")
                            {
                            	testemunho.p.label = "Do que vocÃª estÃ¡ falando?!";
                            }
                        }
                    });
                },
            });


            //Testemunhas
            //No tutorial -> enemy that walks around          
            Q.Sprite.extend("testemunha01", {
                init: function (p) {
                    this._super(p, {vx: -100, defaultDirection: "left"});
                    this.add("2d, aiBounce, commonEnemy1");
                },
                step: function (dt) {
                    var dirX = this.p.vx / Math.abs(this.p.vx);
                    var ground = Q.stage().locate(this.p.x, this.p.y + this.p.h / 2 + 1, Q.SPRITE_DEFAULT);
                    var nextTile = Q.stage().locate(this.p.x + dirX * this.p.w / 2 + dirX, this.p.y + this.p.h / 2 + 1, Q.SPRITE_DEFAULT);

                    //if we are on ground and there is a cliff
                    if (!nextTile && ground) {
                        if (this.p.vx > 0) {
                            if (this.p.defaultDirection == "right") {
                                this.p.flip = "x";
                            }
                            else {
                                this.p.flip = false;
                            }
                        }
                        else {
                            if (this.p.defaultDirection == "left") {
                                this.p.flip = "x";
                            }
                            else {
                                this.p.flip = false;
                            }
                        }
                        this.p.vx = -this.p.vx;
                    }
                }
            });

            Q.Sprite.extend("testemunha02", {
                init: function (p) {
                    this._super(p, {vx: -100, defaultDirection: "left"});
                    this.add("2d, aiBounce, commonEnemy2");
                },
                step: function (dt) {
                    var dirX = this.p.vx / Math.abs(this.p.vx);
                    var ground = Q.stage().locate(this.p.x, this.p.y + this.p.h / 2 + 1, Q.SPRITE_DEFAULT);
                    var nextTile = Q.stage().locate(this.p.x + dirX * this.p.w / 2 + dirX, this.p.y + this.p.h / 2 + 1, Q.SPRITE_DEFAULT);

                    //if we are on ground and there is a cliff
                    if (!nextTile && ground) {
                        if (this.p.vx > 0) {
                            if (this.p.defaultDirection == "right") {
                                this.p.flip = "x";
                            }
                            else {
                                this.p.flip = false;
                            }
                        }
                        else {
                            if (this.p.defaultDirection == "left") {
                                this.p.flip = "x";
                            }
                            else {
                                this.p.flip = false;
                            }
                        }
                        this.p.vx = -this.p.vx;
                    }
                }
            });

            Q.Sprite.extend("testemunha03", {
                init: function (p) {
                    this._super(p, {vx: -100, defaultDirection: "left"});
                    this.add("2d, aiBounce, commonEnemy3");
                },
                step: function (dt) {
                    var dirX = this.p.vx / Math.abs(this.p.vx);
                    var ground = Q.stage().locate(this.p.x, this.p.y + this.p.h / 2 + 1, Q.SPRITE_DEFAULT);
                    var nextTile = Q.stage().locate(this.p.x + dirX * this.p.w / 2 + dirX, this.p.y + this.p.h / 2 + 1, Q.SPRITE_DEFAULT);

                    //if we are on ground and there is a cliff
                    if (!nextTile && ground) {
                        if (this.p.vx > 0) {
                            if (this.p.defaultDirection == "right") {
                                this.p.flip = "x";
                            }
                            else {
                                this.p.flip = false;
                            }
                        }
                        else {
                            if (this.p.defaultDirection == "left") {
                                this.p.flip = "x";
                            }
                            else {
                                this.p.flip = false;
                            }
                        }
                        this.p.vx = -this.p.vx;
                    }
                }
            });

            //load assets
            Q.load("tiles_map.png, player.png, testemunha1.png, testemunha2.png, testemunha3.png, level1.tmx, level2.tmx, matopipa2.png, sobradinho2.png, igrejaDoCarmo.png, level3.tmx, jurubatiba.png, level4.tmx, level5.tmx, usina.png, museu.png, level6.tmx, levelErroJuru.tmx, levelErroIgre.tmx, levelErroMP.tmx, levelErroSob.tmx, gameover.png, levelGO.tmx, jao.png", function () {
                Q.sheet("tiles", "tiles_map.png", {tilew: 70, tileh: 70});
                Q.stageScene("level1");
                Q.stageScene("dialogo", 1);
                Q.stageScene("menu", 2);

            });

            //level 1
            Q.scene("level1", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level1.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level1.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            Q.scene("level1", function (stage) {

                var background = new Q.TileLayer({dataAsset: "level1.tmx", layerIndex: 0, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);

                stage.collisionLayer(new Q.TileLayer({dataAsset: "level1.tmx", layerIndex: 1, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_DEFAULT}));

                //level assets. format must be as shown: [[ClassName, params], .. ] 
                var levelAssets = [
                    ["casa", {x: 10 * 70, y: 411, asset: "matopipa2.png", points: "[[0,0],[1,1]]"}],
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());

                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            //level 2
            Q.scene("level2", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level2.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level2.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
            Q.scene("level2", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level2.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level2.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));
                //setupLevel("level2",stage);

                //carrega o sobradinho e as testemunhas
                var levelAssets = [
                    ["sobradinho", {x: 10 * 70, y: 411, asset: "sobradinho2.png", points: "[[0,0],[1,1]]"}], 
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            //level 3
            Q.scene("level3", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level3.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level3.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            Q.scene("level3", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level3.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level3.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));
                //setupLevel("level2",stage);

                var levelAssets = [
                    ["IgrejaCarmo", {x: 10 * 70, y: 411, asset: "igrejaDoCarmo.png", points: "[[0,0],[1,1]]"}], //carrega o sobradinho e as testemunhas
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            //level 4
            Q.scene("level4", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level4.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level4.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            Q.scene("level4", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level4.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level4.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));
                //setupLevel("level2",stage);

                var levelAssets = [
                    ["juruba", {x: 10 * 70, y: 411, asset: "jurubatiba.png", points: "[[0,0],[1,1]]"}], //carrega o sobradinho e as testemunhas
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});
            });

            //level 5
            Q.scene("level5", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level5.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level5.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            Q.scene("level5", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level5.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level5.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));
                //setupLevel("level2",stage);

                var levelAssets = [
                    ["varUsina", {x: 10 * 70, y: 307, asset: "usina.png", points: "[[0,0],[1,1]]"}], //carrega o sobradinho e as testemunhas
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            //level 6
            Q.scene("level6", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level6.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level6.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            Q.scene("level6", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'level6.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'level6.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));
                //setupLevel("level2",stage);

                var levelAssets = [
                    ["museuQS", {x: 10 * 70, y: 411, asset: "museu.png", points: "[[0,0],[1,1]]"}], //carrega o sobradinho e as testemunhas
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            //errado jurubatida
            Q.scene("levelErroJuru", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'levelErroJuru.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'levelErroJuru.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            Q.scene("levelErroJuru", function (stage) {

                var background = new Q.TileLayer({dataAsset: "levelErroJuru.tmx", layerIndex: 0, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);

                stage.collisionLayer(new Q.TileLayer({dataAsset: "levelErroJuru.tmx", layerIndex: 1, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_DEFAULT}));

                //level assets. format must be as shown: [[ClassName, params], .. ] 
                var levelAssets = [
                    ["juruErro", {x: 10 * 70, y: 411, asset: "jurubatiba.png", points: "[[0,0],[1,1]]"}],
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());

                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
            //level errado Igreja


            Q.scene("levelErroIgre", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'levelErroIgre.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'levelErroIgre.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });

            Q.scene("levelErroIgre", function (stage) {

                var background = new Q.TileLayer({dataAsset: "levelErroIgre.tmx", layerIndex: 0, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);

                stage.collisionLayer(new Q.TileLayer({dataAsset: "levelErroIgre.tmx", layerIndex: 1, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_DEFAULT}));

                //level assets. format must be as shown: [[ClassName, params], .. ] 
                var levelAssets = [
                    ["igreErro", {x: 10 * 70, y: 340, asset: "igrejaDoCarmo.png", points: "[[0,0],[1,1]]"}],
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());

                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
            // Level errado M.P
            Q.scene("levelErroMP", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'levelErroMP.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'levelErroMP.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
            Q.scene("levelErroMP", function (stage) {

                var background = new Q.TileLayer({dataAsset: "levelErroMP.tmx", layerIndex: 0, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);

                stage.collisionLayer(new Q.TileLayer({dataAsset: "levelErroMP.tmx", layerIndex: 1, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_DEFAULT}));

                //level assets. format must be as shown: [[ClassName, params], .. ] 
                var levelAssets = [
                    ["MPErro", {x: 10 * 70, y: 411, asset: "matopipa2.png", points: "[[0,0],[1,1]]"}],
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());

                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
            // sobradinho erro
            Q.scene("levelErroSob", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'levelErroSob.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'levelErroSob.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
            Q.scene("levelErroSob", function (stage) {

                var background = new Q.TileLayer({dataAsset: "levelErroSob.tmx", layerIndex: 0, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);

                stage.collisionLayer(new Q.TileLayer({dataAsset: "levelErroSob.tmx", layerIndex: 1, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_DEFAULT}));

                //level assets. format must be as shown: [[ClassName, params], .. ] 
                var levelAssets = [
                    ["SobErro", {x: 10 * 70, y: 411, asset: "sobradinho2.png", points: "[[0,0],[1,1]]"}],
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());

                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
            
            //game over
                Q.scene("Jao", function (stage) {
                var background = new Q.TileLayer({dataAsset: 'levelErroSob.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);
                stage.collisionLayer(new Q.TileLayer({dataAsset: 'levelErroSob.tmx', layerIndex: 1, sheet: 'tiles', tileW: 70, tileH: 70}));

                var player = stage.insert(new Q.Player());
                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
            Q.scene("Jao", function (stage) {

                var background = new Q.TileLayer({dataAsset: "levelErroSob.tmx", layerIndex: 0, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_NONE});
                stage.insert(background);

                stage.collisionLayer(new Q.TileLayer({dataAsset: "levelErroSob.tmx", layerIndex: 1, sheet: "tiles", tileW: 70, tileH: 70, type: Q.SPRITE_DEFAULT}));
                //level assets. format must be as shown: [[ClassName, params], .. ] 
                var levelAssets = [
                    ["bandido", {x: 10 * 70, y: 411, asset: "jao.png", points: "[[0,0],[1,1]]"}],
                    ["testemunha01", {x: 18 * 70, y: 6 * 70, asset: "testemunha1.png"}],
                    ["testemunha02", {x: 5 * 70, y: 6 * 70, asset: "testemunha2.png"}],
                    ["testemunha03", {x: 12 * 70, y: 120, asset: "testemunha3.png"}]
                ];

                //load level assets
                stage.loadAssets(levelAssets);

                var player = stage.insert(new Q.Player());

                stage.add("viewport").follow(player, {x: true, y: true}, {minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

            });
        </script>
    </body>
</html>
